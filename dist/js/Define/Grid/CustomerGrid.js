Ext.define("chl.gird.CustomerGrid",{alternateClassName:["CustomerGrid"],alias:"widget.CustomerGrid",extend:"chl.grid.BaseGrid",store:"CustomerGridStoreId",stateful:!1,actionBaseName:"CustomerGridAction",listeners:{itemclick:function(grid,record,hitem,index,e,opts){},itemdblclick:function(grid,record,hitem,index,e,opts){},itemcontextmenu:function(view,rec,item,index,e,opts){e.stopEvent()},beforeitemmousedown:function(view,record,item,index,e,options){},selectionchange:function(view,seles,op){seles[0]&&ActionBase.updateActions("CustomerGridAction",seles)}},columns:[],dockedItems:[{xtype:"toolbar",itemId:"toolbarID",dock:"top",layout:{overflowHandler:"Menu"},items:[ActionBase.getAction("refreshCustomer"),ActionBase.getAction("addCustomer")]},{xtype:"Pagingtoolbar",itemId:"pagingtoolbarID",store:"CustomerGridStoreId",dock:"bottom",items:[]}],initComponent:function(){var me=this;me.callParent(arguments),ActionBase.setTargetView(me.actionBaseName,me),ActionBase.updateActions(me.actionBaseName,me.getSelectionModel().getSelection())},loadGrid:function(isSearch){var me=this,store=me.getStore();store.pageSize=GlobalConfig.GridPageSize;var sessiontoken=store.getProxy().extraParams.sessiontoken;!sessiontoken||0==sessiontoken.length;var filter={};store.filterMap.each(function(key,value,length){filter[key]=value}),store.getProxy().extraParams.filter=Ext.JSON.encode(filter),store.getProxy().extraParams.refresh=1,store.loadPage(1),store.getProxy().extraParams.refresh=null,ActionBase.updateActions(me.actionBaseName,me.getSelectionModel().getSelection())}}),GridManager.CreateCustomerGrid=function(param){var tmpArr=[{text:"编号",dataIndex:"customer_id",renderer:GlobalFun.UpdateRecord,width:100},{text:"客户名",dataIndex:"customer_name",renderer:GlobalFun.UpdateRecord,width:100},{text:"手机号",dataIndex:"mobile",renderer:GlobalFun.UpdateRecord,width:100},{text:"发放面单号开始",dataIndex:"customize_number_from",renderer:GlobalFun.UpdateRecord,width:100},{text:"发放面单号结束",dataIndex:"customize_number_to",renderer:GlobalFun.UpdateRecord,width:100},{text:"房租单价",dataIndex:"rent_area",renderer:GlobalFun.UpdateRecord,width:100},{text:"面积单量比",dataIndex:"area_to_order_number",renderer:GlobalFun.UpdateRecord,width:100},{text:"房租单价",dataIndex:"rent_pre_price",renderer:GlobalFun.UpdateRecord,width:100},{text:"过期时间",dataIndex:"expires_date",renderer:GlobalFun.UpdateRecord,width:100}];return GridManager.CustomerGrid=Ext.create("chl.gird.CustomerGrid",GridManager.BaseGridCfg("CustomerGrid","CustomerGridState",tmpArr)),param&&param.needLoad&&GridManager.CustomerGrid.loadGrid(),GridManager.CustomerGrid},GridManager.SetCustomerGridSelectionChangeEvent=function(param){GridManager.CustomerGrid.on("selectionchange",function(view,seles,op){!seles[0]})},Ext.define("chl.Grid.AddUpdateCustomerWin",{extend:"Ext.window.Window",title:"添加",defaultFocus:"CustomerItemId",iconCls:"",record:!1,height:500,width:830,layout:"vbox",modal:!0,resizable:!1,items:[{xtype:"form",itemId:"formId",autoScroll:!0,height:450,width:810,border:!1,bodyPadding:5,defaultType:"textfield",layout:{type:"table",columns:2},defaults:{labelAlign:"right",labelPad:15,width:340,labelWidth:125,maxLength:100,maxLengthText:"最大长度为100"},items:[{name:"customer_name",fieldLabel:"客户名",itemId:"customer_nameItemId",validateOnBlur:!1,allowBlank:!1,blankText:"不能为空"},{name:"Name",fieldLabel:"姓名",itemId:"NameItemId1",validateOnBlur:!1,allowBlank:!1,blankText:"不能为空"},{xtype:"fieldset",colspan:2,title:"规则",itemId:"ReNewManageHistory",collapsible:!0,padding:"2 2 2 5",width:780,defaults:{labelAlign:"right",labelPad:15,xtype:"fieldset",defaults:{labelAlign:"right",labelPad:15,width:340,labelWidth:125,maxLength:100,maxLengthText:"最大长度为100"}},items:[],listeners:{boxready:function(com){for(key in GlobalConfig.Province)com.add({title:GlobalConfig.Province[key],items:[{xtype:"label",text:"现有规则:1"},{xtype:"button",width:100,text:"添加规则",myval:key,handler:function(com){Ext.create("Ext.window.Window",{title:com.myval,width:800,height:600,modal:!0,autoScroll:!0,layout:"vbox",dockedItems:[{xtype:"form",dock:"top",bodyStyle:{padding:"10 5 5 5"},height:130,width:810,layout:{type:"table",columns:2},defaultType:"textfield",defaults:{labelAlign:"right",labelPad:15,width:340,labelWidth:125,maxLength:100,maxLengthText:"最大长度为100"},items:[{xtype:"fieldcontainer",fieldLabel:"区间",labelWidth:100,width:800,colspan:2,layout:"hbox",items:[{xtype:"numberfield",validateOnChange:!0,minValue:0,maxValue:9999},{xtype:"splitter"},{xtype:"numberfield",regex:GlobalConfig.RegexController.regexMoney2Fixed,regexText:"请填写两位小数的数字"}]},{fieldLabel:"价格"},{xtype:"button",colspan:2,text:"添加",handler:function(com){var win=com.up("window");win.add({xtype:"fieldset",title:"规则1"})}}]}],items:[{xtype:"fieldset",title:"规则1"}],buttons:[{text:"确定"},{text:"取消"}]}).show()}}]})}}}]}],buttons:[{text:"重置",handler:function(){var me=this,w=me.up("window"),f=w.down("#formId");if(f.getForm().reset(),"update"==w.action){var sm=w.grid.getSelectionModel();sm.hasSelection()&&f.getForm().loadRecord(sm.getSelection()[0])}}},{text:"确定",itemId:"submit",handler:function(){var me=this,w=me.up("window"),form=w.down("#formId").getForm();if(form.isValid()){var url="create"==w.action?GlobalConfig.Controllers.CustomerGrid.addCustomer:GlobalConfig.Controllers.CustomerGrid.updateCustomer;form.submit({url:url,params:{req:"dataset",dataname:"AddUpdateCustomer",restype:"json",Id:w.record?w.record.data.ControllTid:0,logId:w.record?w.record.data.Id:0,action:w.action,sessiontoken:GlobalFun.getSeesionToken()},success:function(form,action){w.grid.loadGrid(),w.close()},failure:function(form,action){GlobalFun.errorProcess(action.result.code)||Ext.Msg.alert("失败",action.result.msg)}})}}},{text:"取消",handler:function(){var me=this;me.up("window").close()}}]});
//# sourceMappingURL=CustomerGrid.js.map