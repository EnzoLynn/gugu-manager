Ext.define("chl.Action.CustomerRentGridAction",{extend:"WS.action.Base",category:"CustomerRentGridAction"}),Ext.create("chl.Action.CustomerRentGridAction",{itemId:"editCustomerRule",iconCls:"edit",tooltip:"添加规则",text:"添加规则",handler:function(){var me=this,target=me.getTargetView(),record=target.getSelectionModel().getSelection()[0];ActionManager.editCustomerRule(target,record)},updateStatus:function(selection){this.setDisabled(1!=selection.length)}}),Ext.create("chl.Action.CustomerRentGridAction",{itemId:"refreshCustomerRent",iconCls:"refresh",tooltip:"刷新",text:"刷新",handler:function(){var target=this.getTargetView();ActionManager.refreshCustomerRent(target)},updateStatus:function(selection){}}),ActionManager.refreshCustomerRent=function(target){target.loadGrid()};var CustomerRentGrid_RightMenu=Ext.create("Ext.menu.Menu",{items:[ActionBase.getAction("refreshCustomerRent"),"-",ActionBase.getAction("editCustomerRule")]});Ext.define("chl.gird.CustomerRentGrid",{alternateClassName:["CustomerRentGrid"],alias:"widget.CustomerRentGrid",extend:"chl.grid.BaseGrid",store:"CustomerRentGridStoreId",stateful:!1,actionBaseName:"CustomerRentGridAction",listeners:{itemclick:function(grid,record,hitem,index,e,opts){},itemdblclick:function(grid,record,hitem,index,e,opts){},itemcontextmenu:function(view,rec,item,index,e,opts){e.stopEvent(),CustomerRentGrid_RightMenu.showAt(e.getXY())},beforeitemmousedown:function(view,record,item,index,e,options){},selectionchange:function(view,seles,op){seles[0]&&ActionBase.updateActions("CustomerRentGridAction",seles)}},columns:[{text:"编号",dataIndex:"customer_rent_id",renderer:GlobalFun.UpdateRecord,width:100},{text:"租贷面积(平米)",dataIndex:"rent_area",renderer:GlobalFun.UpdateRecord,width:100},{text:"面积单量比",dataIndex:"area_to_order_number",renderer:GlobalFun.UpdateRecord,width:100},{text:"房租单价",dataIndex:"rent_pre_price",renderer:GlobalFun.UpdateRecord,width:100},{text:"开始日期",dataIndex:"date_start",renderer:GlobalFun.UpdateRecord,width:100},{text:"结束日期",dataIndex:"date_end",renderer:GlobalFun.UpdateRecord,width:100}],dockedItems:[{xtype:"toolbar",itemId:"toolbarID",dock:"top",layout:{overflowHandler:"Menu"},items:[ActionBase.getAction("refreshCustomerRent"),"-",ActionBase.getAction("editCustomerRule")]},{xtype:"Pagingtoolbar",itemId:"pagingtoolbarID",store:"CustomerRentGridStoreId",dock:"bottom",items:[]}],initComponent:function(){var me=this;me.callParent(arguments),ActionBase.setTargetView(me.actionBaseName,me),ActionBase.updateActions(me.actionBaseName,me.getSelectionModel().getSelection())},loadGrid:function(isSearch){var me=this,store=me.getStore(),sessiontoken=store.getProxy().extraParams.sessiontoken;!sessiontoken||0==sessiontoken.length;var filter={};store.filterMap.each(function(key,value,length){filter[key]=value}),store.getProxy().extraParams.filter=Ext.JSON.encode(filter),store.getProxy().extraParams.refresh=1,store.loadPage(1),store.getProxy().extraParams.refresh=null,ActionBase.updateActions(me.actionBaseName,me.getSelectionModel().getSelection())}}),GridManager.CreateCustomerRentGrid=function(param){var tmpArr=[{text:"编号",dataIndex:"customer_rent_id",renderer:GlobalFun.UpdateRecord,width:100},{text:"合同名",dataIndex:"title",renderer:GlobalFun.UpdateRecord,width:100},{text:"租贷面积(平米)",dataIndex:"rent_area",renderer:GlobalFun.UpdateRecord,width:100},{text:"面积单量比",dataIndex:"area_to_order_number",renderer:GlobalFun.UpdateRecord,width:100},{text:"房租单价",dataIndex:"rent_pre_price",renderer:GlobalFun.UpdateRecord,width:100},{text:"开始日期",dataIndex:"date_start",renderer:GlobalFun.UpdateRecord,width:100},{text:"结束日期",dataIndex:"date_end",renderer:GlobalFun.UpdateRecord,width:100}];return GridManager.CustomerRentGrid=Ext.create("chl.gird.CustomerRentGrid",GridManager.BaseGridCfg("CustomerRentGrid","CustomerRentGridState",tmpArr)),param&&param.needLoad&&GridManager.CustomerRentGrid.loadGrid(),GridManager.CustomerRentGrid},GridManager.SetCustomerRentGridSelectionChangeEvent=function(param){GridManager.CustomerRentGrid.on("selectionchange",function(view,seles,op){!seles[0]})},ActionManager.editCustomerRule=function(target,record){var param={customer_rent_id:record.data.customer_rent_id,sessiontoken:GlobalFun.getSeesionToken()};WsCall.call(GlobalConfig.Controllers.CustomerGrid.GetCustomerRuleByRentId,"GetCustomerRuleByRentId",param,function(response,opts){var data=response.data;WindowManager.AddUpdateCustomerRuleWin=Ext.create("chl.Grid.AddUpdateCustomerRuleWin",{grid:target,iconCls:"edit",record:record,action:"update",title:"编辑"}),WindowManager.AddUpdateCustomerRuleWin.show(null,function(){Ext.Array.each(data,function(item,index,alls){var temp=WindowManager.AddUpdateCustomerRuleWin.down("#lbl"+item.province_code);temp.setText("现有规则:"+item.count)}),WindowManager.AddUpdateCustomerRuleWin.down("#formId").loadRecord(record)})},function(response,opts){GlobalFun.errorProcess(response.code)||Ext.Msg.alert("失败",response.msg)},!0)};
//# sourceMappingURL=CustomerRentGrid.js.map