Ext.define("chl.exUnit.GridFilterMenuButton",{alias:"widget.GridFilterMenuButton",extend:"Ext.button.Button",filterParam:!1,menu:{defaults:{xtype:"menucheckitem"},items:[]},initComponent:function(){var me=this;me.callParent(arguments),me.on("boxready",function(componet,width,height,eOpts){if(me.filterParam){var target=componet.up(me.filterParam.GridTypeName);me.filterParam.menuType&&"date"==me.filterParam.menuType?GridManager.CreateGridFilterDateMenu(componet,{group:me.filterParam.group,text:me.filterParam.text,target:target,componet:componet,filterKey:me.filterParam.filterKey}):GridManager.CreateGridFilterMenu(componet,me.filterParam.store,{group:me.filterParam.group,text:me.filterParam.text,target:target,componet:componet,filterKey:me.filterParam.filterKey})}})}}),Ext.define("chl.exUnit.GridSelectCancelMenuButton",{alias:"widget.GridSelectCancelMenuButton",extend:"Ext.button.Button",targetName:!1,menu:{defaults:{xtype:"menuitem"},items:[]},initComponent:function(){var me=this;me.callParent(arguments),me.on("boxready",function(componet,width,height,eOpts){var target=componet.up(me.targetName);GridManager.CreateGridSelectCancelMenu(componet,target)})}}),Ext.define("chl.exUnit.MiniPngDDSortPanel",{alias:"widget.MiniPngDDSortPanel",extend:"Ext.container.Container",alternateClassName:["MiniPngDDSortPanel"],itemId:"MiniPngDDSortPanel",frame:!1,layout:{type:"auto",width:100},bodyStyle:{background:"#DFE8F6"},autoScroll:!0,defaults:{xtype:"image",width:100,height:100,margin:"5 5 5 5",style:{"float":"left"}},items:[]}),Ext.define("MiniPngDDSortViewClass",{config:{selectAll:0,pngSels:new Ext.util.MixedCollection,pngAllMini:new Ext.util.MixedCollection,RowId:0,AreaId:0,currPngTotal:1,shiftImg:0},constructor:function(cfg){this.initConfig(cfg),this.pngSels=new Ext.util.MixedCollection,this.pngSelBig=new Ext.util.MixedCollection,this.pngAllMini=new Ext.util.MixedCollection},initPngPanel:function(palPngContainer){var window=palPngContainer.up("window"),pngClass=window.pngClass,pngNStyle={border:"1px solid black","background-color":"#FFFFFF","background-image":"none","background-repeat":"no-repeat"},param={limit:0,page:0,filter:"{ AreaId: "+pngClass.AreaId+",RowId:"+pngClass.RowId+" }",dir:"ASC",sort:"SortNum",sessiontoken:GlobalFun.getSeesionToken()};WsCall.call(GlobalConfig.Controllers.TombstoneGrid.read,"LoadTombstoneGrid",param,function(response,opts){var data=response.dataset;window.el.mask("请稍候..."),Ext.Array.each(data,function(item,index,allItems){var src=GlobalFun.GetTomestoneImageSrc(item.PaymentStatusId,item.Id,item.TypeId),pngContainer=Ext.create("Ext.container.Container",{width:100,height:80,tombstoneId:item.Id,layout:{type:"vbox",align:"center"},items:[{xtype:"image",cls:"hospital-target",sortNum:index,tombstoneId:item.Id,width:77,height:60,style:pngNStyle,src:src,listeners:{boxready:function(img,width,height,opts){DropDragControl.initializeHospitalDropZone(img,window);var imgDom=img.getEl();pngClass.getPngAllMini().add(img.id,img),imgDom.on("click",function(eve){if(!stopClick){if(eve.ctrlKey){pngClass.setShiftImg(img);var borderStyle=imgDom.getStyle("border",!0);return void("1px solid black"==borderStyle||"black 1px solid"==borderStyle?(imgDom.setStyle("border","3px solid blue"),pngClass.getPngSels().contains(img)||(DropDragControl.uninitHospitalDropZone(img),DropDragControl.initializePatientDragZone(img,window),pngClass.getPngSels().add(img.id,img))):(imgDom.setStyle("border","1px solid black"),pngClass.getPngSels().contains(img)&&(DropDragControl.uninitPatientDragZone(img),DropDragControl.initializeHospitalDropZone(img,window),pngClass.getPngSels().remove(img))))}if(eve.shiftKey){var firstImg,imageList=palPngContainer.query("image");return Ext.Array.each(imageList,function(item,index,allItems){0==index&&(firstImg=0!=pngClass.getShiftImg()?pngClass.getShiftImg():item),DropDragControl.uninitPatientDragZone(item),DropDragControl.initializeHospitalDropZone(item,window)}),pngClass.getPngSels().clear(),void Ext.Array.each(imageList,function(item,index,allItems){var imgItem=item.getEl();imgItem.setStyle("border","1px solid black"),item.sortNum>=firstImg.sortNum&&item.sortNum<=img.sortNum&&!item.ownerCt.disabled&&(imgItem.setStyle("border","3px solid blue"),DropDragControl.uninitHospitalDropZone(item),DropDragControl.initializePatientDragZone(item,window),pngClass.getPngSels().add(item.id,item)),item.sortNum<=firstImg.sortNum&&item.sortNum>=img.sortNum&&!item.ownerCt.disabled&&(imgItem.setStyle("border","3px solid blue"),DropDragControl.uninitHospitalDropZone(item),DropDragControl.initializePatientDragZone(item,window),pngClass.getPngSels().add(item.id,item))})}pngClass.setShiftImg(img);var imageList=palPngContainer.query("image");Ext.Array.each(imageList,function(item,index,allItems){DropDragControl.uninitPatientDragZone(item),DropDragControl.initializeHospitalDropZone(item,window)}),pngClass.getPngSels().clear(),Ext.Array.each(imageList,function(item,index,allItems){var imgItem=item.getEl();imgItem.setStyle("border","1px solid black"),item.id==img.id&&(imgItem.setStyle("border","3px solid blue"),DropDragControl.uninitHospitalDropZone(item),DropDragControl.initializePatientDragZone(item,window),pngClass.getPngSels().add(item.id,item))})}}),imgDom.on("dblclick",function(){var imageList=palPngContainer.query("image");Ext.Array.each(imageList,function(item,index,allItems){DropDragControl.uninitPatientDragZone(item),DropDragControl.initializeHospitalDropZone(item,window)}),pngClass.getPngSels().clear(),Ext.Array.each(imageList,function(item,index,allItems){var imgItem=item.getEl();imgItem.setStyle("border","1px solid black")});var borderStyle=imgDom.dom.style.border;("1px solid black"==borderStyle||"black 1px solid"==borderStyle)&&(imgDom.setStyle("border","3px solid blue"),pngClass.getPngSels().contains(img)||(DropDragControl.uninitHospitalDropZone(img),DropDragControl.initializePatientDragZone(img,window),pngClass.getPngSels().add(img.id,img)))}),imgDom.dom.onload=function(){imgDom.dom&&imgDom.dom.height>1&&img.ownerCt.el.unmask()}}}},{xtype:"label",text:item.Alias}]});palPngContainer.add(pngContainer)}),window.el.unmask()},function(response,opts){GlobalFun.errorProcess(response.code)||Ext.Msg.alert("失败",response.msg)},!0,"请稍候...",palPngContainer.el)}}),Ext.define("chl.exUnit.AreaTombstoneImagePanel",{alias:"widget.AreaTombstoneImagePanel",extend:"Ext.panel.Panel",alternateClassName:["AreaTombstoneImagePanel"],itemId:"AreaTombstoneImagePanel",frame:!1,bodyStyle:{background:"#DFE8F6"},border:!1,autoScroll:!0,style:{"overflow-x":"auto","white-space":"nowrap"},dockedItems:[{xtype:"container",itemId:"container",layout:{type:"hbox",align:"middle"},height:34,dock:"top",defaults:{margin:"2px 2px 2px 2px"},items:[{xtype:"textfield",itemId:"tombCode",cls:"big-fieldtext",fieldLabel:"区域或墓碑编码",labelWidth:100,labelAlign:"right",allowBlank:!1,blankText:"不能为空",regex:GlobalConfig.RegexController.regexTombstoneCode,regexText:"请输入3位或5位或7位编码",enableKeyEvents:!0,listeners:{keypress:function(field,e,opts){if(e.getKey()==e.ENTER){var toolbar=field.up("container"),showTomb=toolbar.down("#showTomb");showTomb.fireEvent("click",showTomb)}if(e.getKey()==e.ESC){var toolbar=field.up("container"),reset=toolbar.down("#reset");reset.fireEvent("click",reset)}}}},{xtype:"button",text:"选择",handler:function(com){var w=this.up("container"),field=w.down("#tombCode");WindowManager.SelectCemeteryAreaWin=WindowManager.ShowSelectCemeteryAreaWin(),WindowManager.SelectCemeteryAreaWin.callComponent=field}},{text:"显示",xtype:"button",iconCls:"search",width:100,cls:"big-fieldtext",itemId:"showTomb",listeners:{click:function(com){var toolbar=com.up("container"),tombCode=toolbar.down("#tombCode");if(tombCode.isValid()){GridManager.AreaTombstoneImagePanel.removeAll();var param={limit:0,page:0,filter:"{}",dir:"ASC",sort:"SortNum",sessiontoken:GlobalFun.getSeesionToken()},codeVal=tombCode.getValue();codeVal.length>0&&(param.filter='{ "Area": { "Alias": "'+codeVal+'" }, "Row": { "Alias": "'+codeVal+'" }, "Column": { "Alias": "'+codeVal+'" } }'),WsCall.call(GlobalConfig.Controllers.TombstoneGrid.read,"LoadTombstoneGrid",param,function(response,opts){var data=response.dataset;GridManager.AreaTombstoneImagePanel.el.mask("请稍候...");var pngNStyle={border:"1px solid black","background-color":"#FFFFFF","background-image":"none","background-repeat":"no-repeat",cursor:"pointer"},items1=[],pngContainer=Ext.create("Ext.container.Container",{style:{"white-space":"nowrap",margin:"5px 5px 5px 5px"},items:[]}),rowMaps=new Ext.util.MixedCollection,areaSort="ASC";Ext.Array.each(data,function(item,index,allItems){var key=item.RowId;rowMaps.containsKey(key)?rowMaps.get(key).push(item):rowMaps.add(key,[item]),"DESC"==item.AreaSort&&(areaSort="DESC")}),rowMaps.sortByKey(areaSort),rowMaps.each(function(row,index){items1=[],pngContainer=Ext.create("Ext.container.Container",{style:{"white-space":"nowrap",margin:"5px 5px 5px 5px"},items:[]}),Ext.Array.each(row,function(item,index1){var src=GlobalFun.GetTomestoneImageSrc(item.PaymentStatusId,item.Id,item.TypeId),pngContainer1=Ext.create("Ext.container.Container",{width:100,height:80,tombstoneId:item.Id,layout:{type:"vbox",align:"center"},style:{display:"inline-block"},items:[{xtype:"image",sortNum:item.SortNum,tombstoneId:item.Id,PaymentStatusId:item.PaymentStatusId,tombstoneInfo:item,width:77,height:60,style:pngNStyle,src:src,listeners:{boxready:function(img){var imgDom=img.getEl();imgDom.on("click",function(eve){var tid=img.tombstoneId,tombstoneInfo=img.tombstoneInfo;GlobalFun.JobTombPngClickFun(eve,tid,tombstoneInfo)})}}},{xtype:"label",text:item.Alias}]});items1.push(pngContainer1)}),pngContainer.add(items1),GridManager.AreaTombstoneImagePanel.add(pngContainer)}),GridManager.AreaTombstoneImagePanel.el.unmask()},function(response,opts){GlobalFun.errorProcess(response.code)||Ext.Msg.alert("失败",response.msg)},!0,"请稍候...",GridManager.AreaTombstoneImagePanel.el)}}}},{text:"重置",xtype:"button",width:100,cls:"big-fieldtext",itemId:"reset",listeners:{click:function(field){var toolbar=field.up("container"),tombCode=toolbar.down("#tombCode");tombCode.setValue(""),tombCode.unsetActiveError(),tombCode.inputEl.focus(100)}}}]}],items:[]});
//# sourceMappingURL=exUnit.js.map